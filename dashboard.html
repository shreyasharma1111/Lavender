<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lavender Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font (for general text) -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <!-- Pacifico Font (for Lavender title) -->
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8f3ff; /* Light lavender background */
      }
      /* Custom scrollbar for chat history */
      .chat-history::-webkit-scrollbar {
        width: 8px;
      }
      .chat-history::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      .chat-history::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
      }
      .chat-history::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
      /* Custom style for Lavender title */
      .font-pacifico {
        font-family: "Pacifico", cursive;
      }
    </style>
  </head>
  <body class="flex min-h-screen">
    <!-- Sidebar -->
    <aside
      class="w-64 bg-white p-6 shadow-lg rounded-r-2xl flex flex-col justify-between"
    >
      <div>
        <!-- Cute Lavender title - now with Pacifico font -->
        <div
          class="text-3xl font-pacifico text-purple-800 mb-8 flex items-center"
        >
          Lavender <i class="fas fa-flower text-pink-400 text-xl ml-2"></i>
        </div>
        <nav>
          <ul>
            <li class="mb-4">
              <a
                href="#"
                class="flex items-center text-gray-700 hover:text-purple-600 font-medium p-2 rounded-lg transition duration-200"
              >
                <i class="fas fa-book mr-3"></i>
                Journal
              </a>
            </li>
            <li class="mb-4">
              <a
                href="#"
                class="flex items-center text-gray-700 hover:text-purple-600 font-medium p-2 rounded-lg transition duration-200"
              >
                <i class="fas fa-calendar-alt mr-3"></i>
                Period Tracker
              </a>
            </li>
            <li class="mb-4">
              <a
                href="#"
                class="flex items-center text-gray-700 hover:text-purple-600 font-medium p-2 rounded-lg transition duration-200"
              >
                <i class="fas fa-apple-alt mr-3"></i>
                Diet Plan
              </a>
            </li>
            <li class="mb-4">
              <a
                href="#"
                class="flex items-center text-gray-700 hover:text-purple-600 font-medium p-2 rounded-lg transition duration-200"
              >
                <i class="fas fa-medkit mr-3"></i>
                Home Remedies
              </a>
            </li>
            <li class="mb-4">
              <a
                href="#"
                class="flex items-center text-gray-700 hover:text-purple-600 font-medium p-2 rounded-lg transition duration-200"
              >
                <i class="fas fa-handshake mr-3"></i>
                Coaching
              </a>
            </li>
            <li class="mb-4">
              <a
                href="#"
                class="flex items-center text-gray-700 hover:text-purple-600 font-medium p-2 rounded-lg transition duration-200"
              >
                <i class="fas fa-trophy mr-3"></i>
                Challenges
              </a>
            </li>
            <li class="mb-4">
              <a
                href="#"
                class="flex items-center text-gray-700 hover:text-purple-600 font-medium p-2 rounded-lg transition duration-200"
              >
                <i class="fas fa-gavel mr-3"></i>
                Legal Help
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8">
      <!-- Top Header -->
      <header class="flex justify-between items-center mb-8">
        <!-- Dynamic Welcome Message -->
        <h1 class="text-3xl font-bold text-purple-900">
          Welcome, <span id="changingName">Beautiful Soul</span>
          <i class="fas fa-leaf text-pink-400"></i>
        </h1>
        <div class="relative">
          <button
            id="profileDropdownToggle"
            class="text-purple-600 hover:underline flex items-center focus:outline-none"
          >
            <i class="fas fa-user-circle text-2xl mr-2"></i>
            profile
          </button>
          <div
            id="profileDropdown"
            class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden z-10"
          >
            <a
              href="#"
              class="block px-4 py-2 text-gray-800 hover:bg-purple-100 rounded-md"
              >Account Settings</a
            >
            <a
              href="#"
              class="block px-4 py-2 text-gray-800 hover:bg-purple-100 rounded-md"
              >Logout</a
            >
          </div>
        </div>
      </header>

      <!-- Motivational Message -->
      <div
        class="bg-yellow-100 text-yellow-800 p-4 rounded-xl shadow-md mb-8 text-center text-lg font-medium"
      >
        Take a deep breath â€” you got this!
      </div>

      <!-- Dashboard Cards Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Journal Space Card -->
        <div
          class="bg-white p-6 rounded-xl shadow-md transform transition duration-300 hover:scale-105"
        >
          <h2 class="text-xl font-semibold text-purple-800 mb-2">
            Journal Space
          </h2>
          <p class="text-gray-600 mb-4">Write anything from your day</p>
          <textarea
            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-300"
            rows="4"
            placeholder="Start writing..."
          ></textarea>
        </div>

        <!-- Period Tracker Card (Now includes Calendar) -->
        <div
          class="bg-white p-6 rounded-xl shadow-md lg:col-span-2 transform transition duration-300 hover:scale-105"
        >
          <h2 class="text-xl font-semibold text-purple-800 mb-2">
            Period Tracker
          </h2>
          <p class="text-gray-600 mb-4">Track your flow</p>
          <div class="flex flex-col space-y-3 mb-6">
            <label class="block">
              <span class="text-gray-700 text-sm">Last Period Start Date:</span>
              <input
                type="date"
                id="lastPeriodStartDate"
                class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-300"
              />
            </label>
            <label class="block">
              <span class="text-gray-700 text-sm">Last Period End Date:</span>
              <input
                type="date"
                id="lastPeriodEndDate"
                class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-300"
              />
            </label>
            <button
              class="bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600 transition duration-300"
            >
              Save Tracker
            </button>
          </div>

          <h3 class="text-lg font-semibold text-purple-800 mb-4">Calendar</h3>
          <div class="flex justify-between items-center mb-4">
            <button
              id="prevMonth"
              class="px-3 py-1 bg-purple-200 text-purple-800 rounded-lg hover:bg-purple-300 transition duration-200"
            >
              &lt;
            </button>
            <span
              id="currentMonthYear"
              class="text-lg font-medium text-purple-800"
            ></span>
            <button
              id="nextMonth"
              class="px-3 py-1 bg-purple-200 text-purple-800 rounded-lg hover:bg-purple-300 transition duration-200"
            >
              &gt;
            </button>
          </div>
          <div id="calendar" class="grid grid-cols-7 gap-2 text-center text-sm">
            <div class="font-bold text-gray-700">Sun</div>
            <div class="font-bold text-gray-700">Mon</div>
            <div class="font-bold text-gray-700">Tue</div>
            <div class="font-bold text-gray-700">Wed</div>
            <div class="font-bold text-gray-700">Thu</div>
            <div class="font-bold text-gray-700">Fri</div>
            <div class="font-bold text-gray-700">Sat</div>
            <!-- Calendar days will be inserted here by JavaScript -->
          </div>
        </div>

        <!-- AI Phase Tips Card -->
        <div
          class="bg-white p-6 rounded-xl shadow-md transform transition duration-300 hover:scale-105 flex items-center justify-between"
        >
          <div>
            <h2 class="text-xl font-semibold text-purple-800 mb-2">
              AI Phase Tips
            </h2>
            <p class="text-gray-600">Cycle-based auto tips</p>
          </div>
          <img
            src="https://placehold.co/80x80/E0BBE4/FFFFFF?text=AI"
            alt="AI Robot Icon"
            class="rounded-full"
          />
        </div>

        <!-- Home Remedies Card -->
        <div
          class="bg-white p-6 rounded-xl shadow-md transform transition duration-300 hover:scale-105 flex items-center justify-between"
        >
          <div>
            <h2 class="text-xl font-semibold text-purple-800 mb-2">
              Home Remedies
            </h2>
            <p class="text-gray-600">Ayurvedic tips for wellness</p>
          </div>
          <i class="fas fa-leaf text-green-500 text-4xl"></i>
        </div>

        <!-- Emotional Coaching Card -->
        <div
          class="bg-white p-6 rounded-xl shadow-md transform transition duration-300 hover:scale-105 flex items-center justify-between"
        >
          <div>
            <h2 class="text-xl font-semibold text-purple-800 mb-2">
              Emotional Coaching
            </h2>
            <p class="text-gray-600">Learn to say no, set boundaries</p>
          </div>
          <i class="fas fa-gem text-blue-400 text-4xl"></i>
        </div>

        <!-- Weekly Challenges Card -->
        <div
          class="bg-white p-6 rounded-xl shadow-md transform transition duration-300 hover:scale-105"
        >
          <div>
            <h2 class="text-xl font-semibold text-purple-800 mb-2">
              Weekly Challenges
            </h2>
            <p class="text-gray-600">Complete tiny missions</p>
          </div>
          <i class="fas fa-dumbbell text-orange-500 text-4xl"></i>
        </div>

        <!-- Symptom Checker Card (Now a placeholder with button) -->
        <div
          class="bg-white p-6 rounded-xl shadow-md transform transition duration-300 hover:scale-105"
        >
          <h2 class="text-xl font-semibold text-purple-800 mb-2">
            Symptom Checker
          </h2>
          <p class="text-gray-600 mb-4">
            Questions for symptom checking will be added here later.
          </p>
          <button
            id="openSymptomModalBtn"
            class="bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600 transition duration-300 w-full"
          >
            Log Symptoms
          </button>
        </div>

        <!-- Chatbot (Ask Didi) Card -->
        <div
          class="bg-white p-6 rounded-xl shadow-md transform transition duration-300 hover:scale-105"
        >
          <h2 class="text-xl font-semibold text-purple-800 mb-2">Ask Didi</h2>
          <p class="text-gray-600 mb-4">Bia sis advice</p>
          <button
            id="openChatbotBtn"
            class="bg-pink-400 text-white py-2 px-4 rounded-lg hover:bg-pink-500 transition duration-300 w-full"
          >
            Open Chatbot
          </button>
        </div>
      </div>
    </main>

    <!-- Symptom Checker Modal -->
    <div
      id="symptomModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex justify-center items-center z-50 p-4"
    >
      <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-lg">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-2xl font-semibold text-purple-800">
            Log Symptoms for <span id="modalDate"></span>
          </h3>
          <button
            id="closeSymptomModal"
            class="text-gray-500 hover:text-gray-700 text-2xl"
          >
            &times;
          </button>
        </div>
        <div class="space-y-3">
          <label class="block">
            <input type="checkbox" id="symptomHeadache" class="mr-2" /> Headache
          </label>
          <label class="block">
            <input type="checkbox" id="symptomFatigue" class="mr-2" /> Fatigue
          </label>
          <label class="block">
            <input type="checkbox" id="symptomCramps" class="mr-2" /> Cramps
          </label>
          <label class="block">
            <input type="checkbox" id="symptomMoodSwings" class="mr-2" /> Mood
            Swings
          </label>
          <label class="block">
            <input type="checkbox" id="symptomAcne" class="mr-2" /> Acne
          </label>
          <label class="block">
            <input type="checkbox" id="symptomBloating" class="mr-2" /> Bloating
          </label>
          <label class="block">
            <span class="text-gray-700">Notes:</span>
            <textarea
              id="symptomNotes"
              class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-300 mt-1"
              rows="3"
              placeholder="Any additional notes..."
            ></textarea>
          </label>
        </div>
        <div class="mt-6 flex justify-end space-x-3">
          <button
            id="saveSymptomsBtn"
            class="bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600 transition duration-300"
          >
            Save
          </button>
          <button
            id="clearSymptomsBtn"
            class="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition duration-300"
          >
            Clear
          </button>
        </div>
      </div>
    </div>

    <!-- Chatbot Modal -->
    <div
      id="chatbotModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex justify-center items-center z-50 p-4"
    >
      <div
        class="bg-white p-8 rounded-xl shadow-lg w-full max-w-lg h-3/4 flex flex-col"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-2xl font-semibold text-purple-800">Ask Didi</h3>
          <button
            id="closeChatbotBtn"
            class="text-gray-500 hover:text-gray-700 text-2xl"
          >
            &times;
          </button>
        </div>
        <div
          id="chatHistory"
          class="chat-history flex-1 overflow-y-auto border border-gray-300 rounded-lg p-4 mb-4 bg-gray-50"
        >
          <!-- Chat messages will be appended here -->
          <div class="flex justify-start mb-2">
            <div
              class="bg-purple-100 text-purple-800 p-3 rounded-lg max-w-[80%]"
            >
              Hi there! How can I help you today?
            </div>
          </div>
        </div>
        <div class="flex">
          <input
            type="text"
            id="chatInput"
            class="flex-1 p-3 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-purple-300"
            placeholder="Type your message..."
          />
          <button
            id="sendChatBtn"
            class="bg-purple-500 text-white py-3 px-6 rounded-r-lg hover:bg-purple-600 transition duration-300"
          >
            Send
          </button>
        </div>
        <div id="chatbotLoading" class="text-center text-gray-500 mt-2 hidden">
          Didi is thinking...
        </div>
      </div>
    </div>

    <script>
      // Profile Dropdown Logic
      const profileDropdownToggle = document.getElementById(
        "profileDropdownToggle"
      );
      const profileDropdown = document.getElementById("profileDropdown");

      profileDropdownToggle.addEventListener("click", (event) => {
        event.stopPropagation(); // Prevent document click from closing it immediately
        profileDropdown.classList.toggle("hidden");
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", (event) => {
        if (
          !profileDropdown.contains(event.target) &&
          !profileDropdownToggle.contains(event.target)
        ) {
          profileDropdown.classList.add("hidden");
        }
      });

      // Dynamic Welcome Message Logic
      const changingNameEl = document.getElementById("changingName");
      const names = [
        "Beautiful Soul",
        "Dear One",
        "Shining Star",
        "Warrior",
        "Lovely",
      ];

      /**
       * Updates the welcome name randomly on page load.
       */
      function setRandomWelcomeName() {
        const randomIndex = Math.floor(Math.random() * names.length);
        changingNameEl.textContent = names[randomIndex];
      }

      // Call once on page load
      document.addEventListener("DOMContentLoaded", setRandomWelcomeName);

      // Calendar Logic (now in Period Tracker)
      let currentMonth = new Date().getMonth();
      let currentYear = new Date().getFullYear();
      const monthNames = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
      ];
      const calendarEl = document.getElementById("calendar");
      const currentMonthYearEl = document.getElementById("currentMonthYear");
      const prevMonthBtn = document.getElementById("prevMonth");
      const nextMonthBtn = document.getElementById("nextMonth");

      /**
       * Renders the calendar for the given month and year.
       * Highlights dates with recorded periods.
       */
      function renderCalendar() {
        calendarEl.innerHTML = `
                <div class="font-bold text-gray-700">Sun</div>
                <div class="font-bold text-gray-700">Mon</div>
                <div class="font-bold text-gray-700">Tue</div>
                <div class="font-bold text-gray-700">Wed</div>
                <div class="font-bold text-gray-700">Thu</div>
                <div class="font-bold text-gray-700">Fri</div>
                <div class="font-bold text-gray-700">Sat</div>
            `; // Clear and re-add headers

        currentMonthYearEl.textContent = `${monthNames[currentMonth]} ${currentYear}`;

        const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay(); // 0 for Sunday, 1 for Monday, etc.
        const daysInMonth = new Date(
          currentYear,
          currentMonth + 1,
          0
        ).getDate();

        // Add empty divs for leading blank days
        for (let i = 0; i < firstDayOfMonth; i++) {
          const emptyDiv = document.createElement("div");
          emptyDiv.className = "p-2";
          calendarEl.appendChild(emptyDiv);
        }

        // Add days of the month
        for (let day = 1; day <= daysInMonth; day++) {
          const date = new Date(currentYear, currentMonth, day);
          const dateString = date.toISOString().split("T")[0]; //-MM-DD
          const dayEl = document.createElement("div");
          dayEl.className =
            "p-2 rounded-lg cursor-pointer hover:bg-purple-100 transition duration-200";
          dayEl.textContent = day;
          dayEl.dataset.date = dateString;

          // Highlight current day
          const today = new Date();
          if (
            date.getDate() === today.getDate() &&
            date.getMonth() === today.getMonth() &&
            date.getFullYear() === today.getFullYear()
          ) {
            dayEl.classList.add("border-2", "border-purple-500", "font-bold");
          } else {
            dayEl.classList.add("bg-gray-50", "text-gray-800");
          }

          // For period tracking, we'd add highlighting here based on stored period dates
          // For now, it's just a visual calendar.

          calendarEl.appendChild(dayEl);
        }
      }

      // Event Listeners for Calendar
      prevMonthBtn.addEventListener("click", () => {
        currentMonth--;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        renderCalendar();
      });

      nextMonthBtn.addEventListener("click", () => {
        currentMonth++;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        renderCalendar();
      });

      // Initial calendar render
      document.addEventListener("DOMContentLoaded", renderCalendar);

      // Symptom Checker Modal Logic (triggered by "Log Symptoms" button)
      const openSymptomModalBtn = document.getElementById(
        "openSymptomModalBtn"
      );
      const symptomModal = document.getElementById("symptomModal");
      const closeSymptomModalBtn = document.getElementById("closeSymptomModal");
      const modalDateEl = document.getElementById("modalDate");
      const saveSymptomsBtn = document.getElementById("saveSymptomsBtn");
      const clearSymptomsBtn = document.getElementById("clearSymptomsBtn");
      const symptomHeadache = document.getElementById("symptomHeadache");
      const symptomFatigue = document.getElementById("symptomFatigue");
      const symptomCramps = document.getElementById("symptomCramps");
      const symptomMoodSwings = document.getElementById("symptomMoodSwings");
      const symptomAcne = document.getElementById("symptomAcne");
      const symptomBloating = document.getElementById("symptomBloating");
      const symptomNotes = document.getElementById("symptomNotes");

      let selectedDateForSymptoms = null; // To store the date being edited
      // This will now store symptoms independently of the calendar
      const symptomsByDate = {}; // Stores symptoms: { 'YYYY-MM-DD': { symptoms: {headache:true}, notes: '...' } }

      /**
       * Opens the symptom logging modal for a specific date.
       * Default to today if no date is provided (e.g., from "Log Symptoms" button).
       * @param {string} dateString - The date in-MM-DD format.
       */
      function openSymptomModal(
        dateString = new Date().toISOString().split("T")[0]
      ) {
        selectedDateForSymptoms = dateString;
        modalDateEl.textContent = new Date(dateString).toLocaleDateString(
          "en-US",
          { weekday: "long", year: "numeric", month: "long", day: "numeric" }
        );

        // Reset checkboxes and notes
        symptomHeadache.checked = false;
        symptomFatigue.checked = false;
        symptomCramps.checked = false;
        symptomMoodSwings.checked = false;
        symptomAcne.checked = false;
        symptomBloating.checked = false;
        symptomNotes.value = "";

        // Load existing symptoms for the date if any
        if (symptomsByDate[dateString]) {
          const symptoms = symptomsByDate[dateString].symptoms;
          symptomHeadache.checked = symptoms.headache || false;
          symptomFatigue.checked = symptoms.fatigue || false;
          symptomCramps.checked = symptoms.cramps || false;
          symptomMoodSwings.checked = symptoms.moodSwings || false;
          symptomAcne.checked = symptoms.acne || false;
          symptomBloating.checked = symptoms.bloating || false;
          symptomNotes.value = symptomsByDate[dateString].notes || "";
        }

        symptomModal.classList.remove("hidden");
      }

      /**
       * Closes the symptom logging modal.
       */
      function closeSymptomModal() {
        symptomModal.classList.add("hidden");
        selectedDateForSymptoms = null;
      }

      /**
       * Saves the symptoms and notes for the selected date.
       */
      function saveSymptoms() {
        if (!selectedDateForSymptoms) return;

        const symptoms = {
          headache: symptomHeadache.checked,
          fatigue: symptomFatigue.checked,
          cramps: symptomCramps.checked,
          moodSwings: symptomMoodSwings.checked,
          acne: symptomAcne.checked,
          bloating: symptomBloating.checked,
        };
        const notes = symptomNotes.value.trim();

        // Check if any symptom is checked or notes exist
        const hasSymptoms =
          Object.values(symptoms).some((val) => val) || notes.length > 0;

        if (hasSymptoms) {
          symptomsByDate[selectedDateForSymptoms] = { symptoms, notes };
          console.log(
            `Symptoms saved for ${selectedDateForSymptoms}:`,
            symptomsByDate[selectedDateForSymptoms]
          );
        } else {
          // If no symptoms and no notes, remove the entry for this date
          delete symptomsByDate[selectedDateForSymptoms];
          console.log(`Symptoms cleared for ${selectedDateForSymptoms}`);
        }

        closeSymptomModal();
      }

      /**
       * Clears all symptoms and notes for the selected date.
       */
      function clearSymptoms() {
        if (!selectedDateForSymptoms) return;

        delete symptomsByDate[selectedDateForSymptoms];
        console.log(`Symptoms cleared for ${selectedDateForSymptoms}`);
        closeSymptomModal();
      }

      openSymptomModalBtn.addEventListener("click", () => openSymptomModal()); // Open for today by default
      closeSymptomModalBtn.addEventListener("click", closeSymptomModal);
      saveSymptomsBtn.addEventListener("click", saveSymptoms);
      clearSymptomsBtn.addEventListener("click", clearSymptoms);

      // Chatbot Logic
      const openChatbotBtn = document.getElementById("openChatbotBtn");
      const chatbotModal = document.getElementById("chatbotModal");
      const closeChatbotBtn = document.getElementById("closeChatbotBtn");
      const chatHistoryEl = document.getElementById("chatHistory");
      const chatInputEl = document.getElementById("chatInput");
      const sendChatBtn = document.getElementById("sendChatBtn");
      const chatbotLoadingEl = document.getElementById("chatbotLoading");

      const DUMMY_API_KEY = ""; // Keep this empty as per instructions. Canvas will provide the key.

      /**
       * Adds a message to the chat history display.
       * @param {string} message - The message content.
       * @param {'user' | 'didi'} sender - The sender of the message.
       */
      function addMessageToChatHistory(message, sender) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `flex mb-2 ${
          sender === "user" ? "justify-end" : "justify-start"
        }`;
        const bubbleDiv = document.createElement("div");
        bubbleDiv.className = `p-3 rounded-lg max-w-[80%] ${
          sender === "user"
            ? "bg-purple-500 text-white"
            : "bg-purple-100 text-purple-800"
        }`;
        bubbleDiv.textContent = message;
        messageDiv.appendChild(bubbleDiv);
        chatHistoryEl.appendChild(messageDiv);
        chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight; // Scroll to bottom
      }

      /**
       * Sends a message to the Gemini API and displays the response.
       * @param {string} userMessage - The user's message.
       */
      async function sendToGeminiAPI(userMessage) {
        chatbotLoadingEl.classList.remove("hidden"); // Show loading indicator

        try {
          let chatHistory = [];
          chatHistory.push({ role: "user", parts: [{ text: userMessage }] });
          const payload = { contents: chatHistory };
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${DUMMY_API_KEY}`;

          const response = await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const result = await response.json();

          if (
            result.candidates &&
            result.candidates.length > 0 &&
            result.candidates[0].content &&
            result.candidates[0].content.parts &&
            result.candidates[0].content.parts.length > 0
          ) {
            const text = result.candidates[0].content.parts[0].text;
            addMessageToChatHistory(text, "didi");
          } else {
            addMessageToChatHistory(
              "Sorry, I couldn't get a response. Please try again.",
              "didi"
            );
            console.error("Gemini API response structure unexpected:", result);
          }
        } catch (error) {
          console.error("Error calling Gemini API:", error);
          addMessageToChatHistory(
            "Oops! Something went wrong. Please try again later.",
            "didi"
          );
        } finally {
          chatbotLoadingEl.classList.add("hidden"); // Hide loading indicator
        }
      }

      /**
       * Handles sending a message from the chatbot input.
       */
      function handleSendMessage() {
        const message = chatInputEl.value.trim();
        if (message) {
          addMessageToChatHistory(message, "user");
          sendToGeminiAPI(message);
          chatInputEl.value = ""; // Clear input field
        }
      }

      // Event Listeners for Chatbot
      openChatbotBtn.addEventListener("click", () => {
        chatbotModal.classList.remove("hidden");
        chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight; // Ensure it scrolls to bottom when opened
      });
      closeChatbotBtn.addEventListener("click", () => {
        chatbotModal.classList.add("hidden");
      });
      sendChatBtn.addEventListener("click", handleSendMessage);
      chatInputEl.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          handleSendMessage();
        }
      });
    </script>
  </body>
</html>
